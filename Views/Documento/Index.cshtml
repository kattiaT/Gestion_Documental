@if (User.Identity?.IsAuthenticated ?? false)
{
    <h2>Subir y Visualizar Documento</h2>

    <form id="uploadForm" enctype="multipart/form-data">
        <input type="file" name="archivo" id="archivo" required />
        <button type="submit">Subir</button>
    </form>

    <iframe id="docViewer" style="display:none; width:100%; height:500px;" frameborder="0"></iframe>
}
else
{
    <div class="alert alert-warning">
        Debes iniciar sesión con Google antes de subir documentos.  
        <a class="btn btn-primary" asp-controller="Documento" asp-action="Login">Iniciar sesión</a>
    </div>
}

@section Scripts {
<script>
document.getElementById('uploadForm')?.addEventListener('submit', async function (e) {
    e.preventDefault();
    const fd = new FormData();
    fd.append('archivo', document.getElementById('archivo').files[0]);

    const resp = await fetch('/Documento/Subir', { method: 'POST', body: fd });
    if (!resp.ok) {
        const errorText = await resp.text();
        alert("Error al subir: " + errorText);
        return;
    }
    const data = await resp.json();
    const iframe = document.getElementById('docViewer');
    iframe.src = data.previewUrl;
    iframe.style.display = 'block';
});
</script>
}
